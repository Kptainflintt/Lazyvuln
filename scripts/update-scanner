#!/bin/bash
start-services

echo "Syncing OpenVAS feeds..."
greenbone-nvt-sync
greenbone-scapdata-sync
greenbone-certdata-sync
echo "OpenVAS feeds synced."

start-openvas

# There is a problem with SCAP Sync: https://github.com/greenbone/gvmd/issues/822
echo "Checking synchronization progress..."
sleep 5
X="$(ps -aux | grep -v grep | grep 'gvmd: Syncing CERT\|gmvd: Reloading')"
while  [ "${#X}" != 0 ]; do
    sleep 1
    X="$(ps -aux | grep -v grep | grep 'gvmd: Syncing CERT\|gmvd: Reloading')"
done
echo "Synchronized update."